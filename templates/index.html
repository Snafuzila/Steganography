<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StegX</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <div class="container">
    <h1>StegX</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, msg in messages %}
            <div class="flash {{ category }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="grid">
      <!-- ENCODE -->
      <section class="card">
        <h2>Encrypt / Embed</h2>
        <form action="{{ url_for('encode') }}" method="post" enctype="multipart/form-data">
          <div class="field">
            <label for="file_type">Choose file type</label>
            <select name="file_type" id="file_type" required>
              <option value="" disabled selected>Select type…</option>
              {% for opt in allowed_options %}
                <option value="{{ opt.value }}">{{ opt.label }}</option>
              {% endfor %}
            </select>
            <p class="hint">Supported: txt, css, html, video (mov/mkv/avi), image (png/bmp), wav</p>
          </div>

          <div id="video_params" class="video-params" style="display:none;">
            <div class="field">
              <label>Frame duration (seconds)</label>
              <input type="text" name="frame_duration" placeholder="0.1" inputmode="decimal" />
            </div>
            <div class="field">
              <label>Compare fraction (0–1)</label>
              <input type="text" name="compare_fraction" placeholder="0.5" inputmode="decimal" />
            </div>
            <div class="field">
              <label>Header bits (≥16, multiple of 8)</label>
              <input type="text" name="header_bits" placeholder="1010101010101010" pattern="[01]{16,}" />
            </div>
            <div class="field">
              <label>Footer bits (≥16, multiple of 8)</label>
              <input type="text" name="footer_bits" placeholder="0101010101010101" pattern="[01]{16,}" />
            </div>
          </div>

          <div id="wav_params" class="video-params" style="display:none;">
            <div class="field">
              <label>WAV LSBs per sample (1–3)</label>
              <input type="text" name="wav_n_lsb" placeholder="1" pattern="[1-3]" />
            </div>
          </div>

            <div class="field password-field">
              <label for="enc_password">Password</label>
              <input id="enc_password" type="password" name="password" placeholder="Enter password" required />
              <button type="button" class="toggle-pass" data-target="enc_password" aria-label="Toggle password visibility">
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                  <path d="M12 5C5 5 1 12 1 12s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" fill="currentColor"/>
                </svg>
              </button>
            </div>

          <div class="field">
            <label>Message to hide</label>
            <textarea name="message" placeholder="Type your secret message" rows="4" required></textarea>
          </div>

          <div class="field">
            <label>Upload host file</label>
            <input type="file" name="upload_file" required />
          </div>

          <div class="actions">
            <button type="submit">Encrypt</button>
          </div>
        </form>
      </section>

      <!-- DECODE -->
      <section class="card">
        <h2>Decrypt / Extract</h2>
        <form action="{{ url_for('decode') }}" method="post" enctype="multipart/form-data">
          <div class="field">
            <label for="decode_file_type">Choose file type</label>
            <select name="decode_file_type" id="decode_file_type" required>
              <option value="" disabled selected>Select type…</option>
              {% for opt in allowed_options %}
                <option value="{{ opt.value }}">{{ opt.label }}</option>
              {% endfor %}
            </select>
          </div>

          <div id="decode_video_params" class="video-params" style="display:none;">
            <div class="field">
              <label>Frame duration (seconds)</label>
              <input type="text" name="decode_frame_duration" placeholder="0.1" inputmode="decimal" />
            </div>
            <div class="field">
              <label>Compare fraction (0–1)</label>
              <input type="text" name="decode_compare_fraction" placeholder="0.5" inputmode="decimal" />
            </div>
            <div class="field">
              <label>Header bits (≥16, multiple of 8)</label>
              <input type="text" name="decode_header_bits" placeholder="1010101010101010" pattern="[01]{16,}" />
            </div>
            <div class="field">
              <label>Footer bits (≥16, multiple of 8)</label>
              <input type="text" name="decode_footer_bits" placeholder="0101010101010101" pattern="[01]{16,}" />
            </div>
          </div>

          <div id="decode_wav_params" class="video-params" style="display:none;">
            <div class="field">
              <label>WAV LSBs per sample (1–3)</label>
              <input type="text" name="decode_wav_n_lsb" placeholder="1" pattern="[1-3]" />
            </div>
          </div>

          <div class="field password-field">
            <label for="dec_password">Password</label>
            <input id="dec_password" type="password" name="decode_password" placeholder="Enter password" />
            <button type="button" class="toggle-pass" data-target="dec_password" aria-label="Toggle password visibility">
              <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path d="M12 5C5 5 1 12 1 12s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" fill="currentColor"/>
              </svg>
            </button>
          </div>

          <div class="field">
            <label>Upload stego file</label>
            <input type="file" name="decode_upload_file" required />
          </div>

          <div class="actions">
            <button type="submit">Decrypt</button>
          </div>
        </form>
      </section>
    </div>
  </div>

  <script>
    const typeSelect = document.getElementById('file_type');
    const videoParams = document.getElementById('video_params');
    const wavParams = document.getElementById('wav_params');

    function toggleEncodeParams() {
      const v = (typeSelect?.value || '').toLowerCase();
      const isVideo = v === 'video';  
      const isWav = v === 'wav';      
      if (videoParams) videoParams.style.display = isVideo ? '' : 'none';
      if (wavParams) wavParams.style.display = isWav ? '' : 'none';
    }
    typeSelect?.addEventListener('change', toggleEncodeParams);
    toggleEncodeParams();

    const dTypeSelect = document.getElementById('decode_file_type');
    const dVideoParams = document.getElementById('decode_video_params');
    const dWavParams = document.getElementById('decode_wav_params');

    function toggleDecodeParams() {
      const v = (dTypeSelect?.value || '').toLowerCase();
      const isVideo = v === 'video';  
      const isWav = v === 'wav';
      if (dVideoParams) dVideoParams.style.display = isVideo ? '' : 'none';
      if (dWavParams) dWavParams.style.display = isWav ? '' : 'none';
    }
    dTypeSelect?.addEventListener('change', toggleDecodeParams);
    toggleDecodeParams();

    // Auto-download after redirect
    const urlParams = new URLSearchParams(window.location.search);
    const dl = urlParams.get('download');
    if (dl) {
      const link = document.createElement('a');
      link.href = `${window.location.origin}${window.location.pathname.replace(/\/$/, '')}/download/${encodeURIComponent(dl)}`;
      link.download = dl;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // Password visibility toggles
    (function(){
      const svgOpen = '<svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M12 5C5 5 1 12 1 12s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" fill="currentColor"/></svg>';
      const svgClosed = '<svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M2 2l20 20" stroke="currentColor" stroke-width="2"/><path d="M12 5C5 5 1 12 1 12s4 7 11 7c2.1 0 3.98-.56 5.6-1.48" fill="none" stroke="currentColor" stroke-width="2"/></svg>';
      document.querySelectorAll('.toggle-pass').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-target');
            const input = document.getElementById(id);
            if (!input) return;
            const hidden = input.type === 'password';
            input.type = hidden ? 'text' : 'password';
            btn.innerHTML = hidden ? svgClosed : svgOpen;
        });
      });
    })();
  </script>
</body>
</html>


